<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/css/main.css" />
    <title>Comparison</title>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="message">
          <h1>Comparison</h1>
          <p>
            On the left is your translation, and on the right is the reference
            translation.
          </p>
        </div>
        <div class="logo">
          <img src="/img/logo-small.webp" class="logo-img" />
        </div>
      </div>
      <div class="compare-container">
        <div class="compare-left compare-text" id="dest"><h1>Yours</h1></div>
        <div class="compare-right compare-text" id="source"><h1>Reference</h1></div>
      </div>
    </div>
    <script language="javascript" type="module">
      let json = await fetch("/changes/{{resource}}/{{uuid}}/{{lang}}");
      let diff = await json.json();
      let source = document.getElementById("source");
      let dest = document.getElementById("dest");
      for (var change of diff) {
        while (change.content[0] === "\n") {
          dest.innerHTML += "<br>";
          source.innerHTML += "<br>";
          change.content = change.content.substring(1);
        }
        if (change.content === "") {
          continue;
        }
        switch (change.change_type) {
          case "delete":
            dest.innerHTML += `<span class="compare-delete">${change.content}</span>`;
            break;
          case "insert":
            source.innerHTML += `<span class="compare-insert">${change.content}</span>`;
            break;
          case "equal":
            dest.innerHTML += change.content;
            source.innerHTML += change.content;
            break;
          default:
            console.log("Weird diff " + JSON.stringify(diff));
        }
      }
    </script>
  </body>
</html>
